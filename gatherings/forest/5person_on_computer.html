<head>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="../shared/frames.css">
    <script src="common.js"></script>
    <script type="module" src="../shared/draggable-frame.js"></script>
    <script type="module" src="../shared/d-iframe.js"></script>
    <style>
        .InvertedFrame {
            background-color: midnightblue;
            color: blanchedalmond;
            font-size: 30px;
        }

        #frames {
            position: absolute;
        }

        #honeybee {
            border: none;
            filter: blur(0.5px); /* thanks mut */
            pointer-events: none;
        }

        /* .hotspot {
            border: inset 8px brown;
        } */
    </style>
    <script>
        // Clone mouse input events for the unity iframe
        // (so that it always receives mouse input, but only blocks other elements when the cursor is over a honeybee)
        // (this is similar to what's happening in bucket.html, TODO: add a light framework for making this simpler?)
        window.addEventListener('load', () => {
            let main = document.getElementById("main");
            let honeybee = document.getElementById("honeybee");
            let canvas = honeybee.contentDocument.getElementById("unity-canvas");

            ['click', 'mouseenter', 'mouseleave',
            'mouseout', 'mouseover', 'mousemove',
            'mousedown', 'mouseup'].forEach((eventName) => {
                document.addEventListener(eventName, function (e) {
                    const rect = honeybee.getBoundingClientRect();
                    // let e2 = new e.constructor(e.type, e);
                    let e2 = new MouseEvent(e.type, {
                        // Adjust client coordinates to be relative to the iframe document:
                        clientX: e.clientX - rect.x,
                        clientY: e.clientY - rect.y,
                        // Everything else stays the same:
                        screenX: e.screenX,
                        screenY: e.screenY,
                        region: e.region,
                        relatedTarget: e.relatedTarget,
                        composed: e.composed,
                        view: e.view,
                        bubbles: e.bubbles,
                        cancelable: e.cancelable
                    });

                    canvas.dispatchEvent(e2);
                });
            });

            // Override the setpointer callback from unity to set both the pointer style and pointerEvents
            honeybee.contentWindow.setUnityPointer = (pointer) => {
                canvas.style.cursor = pointer ? "pointer" : "default"
                honeybee.style.pointerEvents = pointer ? "all" : "none"
            }
        });
    </script>
</head>

<body>
    <div class="container">
        <main id="main" class="content">
            <img id="background" class="background" src="./images/person_on_computer.png"></img>

            <a class="hotspot inspect" href="./8messy_server_transition.html"
                style="left: 12.987%; top: 25.450%; width: 19.034%; height: 17.011%"></a>
            <a class="hotspot move" href="./1.html" style="left: 0.432%; top: 73.345%; width: 22.125%; height: 22.176%"></a>
            <a class="hotspot centered talk" href="#" onclick="Frames.toggle('rude')"
                style="left: 70.114%; top: 40.604%; width: 13.626%; height: 20.160%"></a>

            <section id="frames" class="Frames">
                <draggable-frame hidden id="rude" x=40 y=15 width=70 height=40 bodyClass="InvertedFrame">
                    <span>Don't be rude, they are using <a href="#" onclick="Frames.show('the-computer')">the
                            computer</a></span>
                </draggable-frame>

                <draggable-frame id="the-computer" hidden x=60 y=28 width=25 height=35>
                    <d-iframe src="https://archive.org/embed/NicholasFedorovTHECOMPUTEROfficialVideo&autoplay=1" width="640" height="480" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></d-iframe>
                </draggable-frame>
            </section>            

            <iframe id="honeybee" class="background" src="../../games/honeybee/web-build/index.html"></iframe>
        </main>
    </div>
</body>