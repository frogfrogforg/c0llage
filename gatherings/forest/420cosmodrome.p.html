<!-- template: neutral -->

<style>
  body {
    overflow: hidden;
  }

  .Cosmodrome {
    display: flex;
    flex-direction: row;
  }

  .CosmodromeCol--sticky {
    position: sticky;
    top: 0;
  }

  .CosmodromeBg {
    width: 100vmin;
    height: 100vmin;
    user-select: none;
    pointer-events: none;
  }
</style>

<body>
  <div class="ForestLayer">
    <main id="cosmodrome" class="Cosmodrome">
      <div class="CosmodromeCol CosmodromeCol--sticky">
        <img class="CosmodromeBg" src="./images/cosmodrome/00noentry.gif">
      </div>

      <div class="CosmodromeCol">
        <img class="CosmodromeBg" src="./images/cosmodrome/10monolith.gif">
        <img class="CosmodromeBg" src="./images/cosmodrome/11natatorium.gif">
        <img class="CosmodromeBg" src="./images/cosmodrome/12slide.gif">
      </div>

      <div class="CosmodromeCol">
        <img class="CosmodromeBg" src="./images/cosmodrome/20niceengine.gif">
      </div>

      <div class="CosmodromeCol">
        <img class="CosmodromeBg" src="./images/cosmodrome/50launching.gif">
        <img class="CosmodromeBg" src="./images/cosmodrome/51launched.gif">
      </div>

      <div class="CosmodromeCol">
        <img class="CosmodromeBg" src="./images/cosmodrome/80victory.gif">
      </div>
    </main>
  </div>
</body>

<script>
  const cosmodrome = document.getElementById("cosmodrome")

  // TODO: undo this later
  let isSet = false

  function hideScroll() {
    if (isSet && document.body.style.overflow != "hidden") {
      alert("nice try gamer")
    }

    isSet = true
    document.body.style.overflow = "hidden"
    requestAnimationFrame(hideScroll)
  }

  hideScroll()

  // -- init --
  function main() {
    initTouch()
  }

  // -- touch --
  let isTouching = false
  let xi = null
  let yi = null

  function initTouch() {
    cosmodrome.addEventListener("pointerdown", didStartTouch)
    cosmodrome.addEventListener("pointermove", didMoveTouch)
    cosmodrome.addEventListener("pointerup", didEndTouch)

    const html = document.querySelector("html")
    html.addEventListener("pointerout", (evt) => {
      if (evt.target == html) {
        this.didEndTouch()
      }
    })
  }

  function didStartTouch(evt) {
    isTouching = true
    xi = evt.clientX
    yi = evt.clientY
  }

  function didMoveTouch(evt) {
    if (!isTouching) {
      return
    }

    const a = Math.PI / 3
    const x = evt.clientX
    const y = evt.clientY

    const dx = x - xi
    const dy = y - yi

    console.log("scroll document", dx, dy)

    document.body.scrollBy({
      top: Math.cos(a) * dx - Math.sin(a) * dy,
      left: Math.sin(a) * dx + Math.cos(a) * dy,
    })

    xi = x
    yi = y
  }

  function didEndTouch() {
    isTouching = false
  }

  // -- boostrap --
  main()
</script>
