<!-- template: neutral -->
<body>
  <main id="scroll-container" class="Wedding">
    <section class="Wedding-zone">
      <img
        class="Wedding-background"
        src="./assets/42069wedding/field.jpg"
      >

      <img
        class="Wedding-arch WeddingSprite"
        src="./assets/42069wedding/arch.png"
      >
    </section>

    <audio id="wedding-music">
      <source
        src="./assets/42069wedding/march.mp3"
        type="audio/mpeg"
      >
    </audio>
  </main>
</body>

<style>
  #scroll-container {
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    cursor: grab;
  }

  .Wedding audio {
    display: none;
  }

  .Wedding-zone {
    position: relative;
    width: fit-content;
  }

  .Wedding-background {
    display: block;
    width: 10000px;
    pointer-events: none;
  }

  .Wedding-arch {
    position: absolute;
    top: 1069px;
    left: 6150px;
    width: 469px;
    transform: skewX(2deg);
    pointer-events: none;
    animation: Wobble 4.20s;
  }

  .WeddingSprite {
    animation-direction: alternate-reverse;
    animation-iteration-count: infinite;
    animation-play-state: paused;
  }

  @keyframes Wobble {
    from { transform: skew(-3deg); }
    to   { transform: skew(3deg); }
  }
</style>

<script type="module">
  // -- props --
  let $el = null
  let $music = null
  let $sprites = []

  // -- init --
  function Main() {
    $el = document.getElementById("scroll-container")
    $music = document.getElementById("wedding-music")
    $sprites = document.getElementsByClassName("WeddingSprite")
    initTouch()
  }

  // -- touch --
  let isTouching = false
  let xi = null
  let yi = null

  function initTouch() {
    $el.addEventListener("pointerdown", didStartTouch)
    $el.addEventListener("pointermove", didMoveTouch)
    $el.addEventListener("pointerup", didEndTouch)

    const $html = document.querySelector("html")
    $html.addEventListener("pointerout", (evt) => {
      if (evt.target == $html) {
        didEndTouch()
      }
    })
  }

  function didStartTouch(evt) {
    isTouching = true
    xi = evt.clientX
    yi = evt.clientY

    // start elements
    $music.play()
    for (const $sprite of $sprites) {
      $sprite.style.animationPlayState = "running"
    }
  }

  function didMoveTouch(evt) {
    if (!isTouching) {
      return
    }

    const x = evt.clientX
    const y = evt.clientY

    const dx = x - xi
    const dy = y - yi

    $el.scrollBy({
      left: -dx,
      top: -dy
    })

    xi = x
    yi = y
  }

  function didEndTouch() {
    isTouching = false

    // pause elements
    $music.pause()
    for (const $sprite of $sprites) {
      $sprite.style.animationPlayState = ""
    }
  }

  // -- bootstrap --
  Main()
</script>