<!-- template: neutral -->
<body>
  <main id="scroll-container" class="Wedding">
    <section class="Wedding-zone">
      <img
        class="Wedding-background"
        src="./assets/42069wedding/field.jpg"
      >

      <!-- TODO: add all the other characters -->
      <!-- TODO: add visit conditions -->
      <a-dumpling title="TODO: wedding">
        <div style="overflow-y: scroll;">
          <p>there should be (a pile of) wedding invitations somewhere that you can collect</p>
          <p>for every character you drag the wedding invitation to, they respond with a dialog</p>
          <p>and whoever was invited shows up in this screen...</p>
          <hr>

          <p>notes on specific characters:</p>
          <p>for the characters in doom, someone needs to mod doom to add an invitation shooting gun</p>
          <p>for the character in bitsy games, you can give invites to claribelle, and they can deliver the invites</p>
        </div>
      </a-dumpling>

      <div id="characters">
        <c-picky wants="invitedAMan">
          <img
            style="bottom: 1500px; left: 6000px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/a-man.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedMagpie">
          <img
            style="bottom: 1520px; left: 4120px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/char/magpie.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedBudgie">
          <img
            style="bottom: 1480px; left: 4200px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/char/budgie.png"
            draggable="false"
          >
        </c-picky>


        <c-picky wants="invitedPigeon">
          <img
            style="bottom: 1480px; left: 4300px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/char/pigeon.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedOstrich">
          <img
            style="bottom: 1520px; left: 4380px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/char/ostrich.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedSPOILERS">
          <img
            style="bottom: 1500px; left: 6800px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/cosmodrome/SPOILERS.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedBaby">
          <img
            style="bottom: 1500px; left: 4600px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/baby.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedAnnie">
          <img
            style="bottom: 1500px; left: 4900px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/walk-talk/annie.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedCarl">
          <img
            style="bottom: 1500px; left: 5000px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/walk-talk/carl.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedJosie">
          <img
            style="bottom: 1500px; left: 3500px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/walk-talk/josie.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedNilson">
          <img
            style="bottom: 1500px; left: 3600px"
            class="Wedding-guest WeddingSprite"
            src="/forest/images/walk-talk/nilson.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedClaribelle">
          <img
            style="bottom: 1500px; left: 5600px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/claribelle.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedComputer">
          <img
            style="bottom: 1500px; left: 5700px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/computer-head.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedCow1">
          <img
            style="bottom: 1500px; left: 5800px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/Cow1.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedCow3">
          <img
            style="bottom: 1500px; left: 5500px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/Cow3.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedDirtBully">
          <img
            style="bottom: 1500px; left: 5900px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/DirtBully.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedQuietLeaf">
          <img
            style="bottom: 1500px; left: 3000px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/quiet-leaf.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedSquirrel">
          <img
            style="bottom: 1500px; left: 3400px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/squirrel.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedSwanglasses">
          <img
            style="bottom: 1500px; left: 3700px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/swanglasses_happy.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedTom">
          <img
            style="bottom: 1500px; left: 3900px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/tom.jpg"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedStaring">
          <img
            style="bottom: 1500px; left: 3800px "
            class="Wedding-guest WeddingSprite"
            src="/forest/images/staring.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedBucket">
          <img
            style="bottom: 1500px; left: 7000px"
            class="Wedding-guest WeddingSprite"
            src="/games/free-juice/img/bucket.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedIrene">
          <img
            style="bottom: 1500px; left: 7200px"
            class="Wedding-guest WeddingSprite"
            src="/d/img/irene.gif"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedFreeSaladChar">
          <img
            style="bottom: 1500px; left: 5400px"
            class="Wedding-guest WeddingSprite"
            src="/jenGame1/FreeSaladChar2.png"
            draggable="false"
          >
        </c-picky>

        <c-picky wants="invitedRoombaCat">
          <img
            style="bottom: 1500px; left: 5200px"
            class="Wedding-guest WeddingSprite"
            src="/jenGame1/RoombaCat.png"
            draggable="false"
          >
        </c-picky>
      </div>

      <img
        id="wedding-arch"
        class="Wedding-arch WeddingSprite"
        src="./assets/42069wedding/arch.png"
        draggable="false"
      >
    </section>

    <audio id="wedding-music">
      <source
        src="./assets/42069wedding/march.mp3"
        type="audio/mpeg"
      >
    </audio>
  </main>
</body>

<style>
  #scroll-container {
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    cursor: grab;
  }

  .Wedding audio {
    display: none;
  }

  .Wedding-zone {
    position: relative;
    width: fit-content;
  }

  .Wedding-background {
    display: block;
    width: 10000px;
    pointer-events: none;
  }

  .Wedding-guest {
    position: absolute;
    height: 100px;
    transform: skewX(2deg);
    transform-origin: bottom center;
    animation: Summer 1.2s;
    image-rendering: pixelated;
    user-select: none;
  }

  .Wedding-arch {
    position: absolute;
    top: 1069px;
    left: 6150px;
    width: 469px;
    transform: skewX(2deg);
    animation: Wobble 4.20s;
    cursor: pointer;
    user-select: none;
  }

  .WeddingSprite {
    animation-direction: alternate-reverse;
    animation-iteration-count: infinite;
    animation-play-state: paused;
  }

  @keyframes Wobble {
    from { transform: skew(-3deg); }
    to   { transform: skew(3deg); }
  }

  @keyframes Summer {
    0%   { transform: skew(0deg) scale(1, 1); }
    10%  { transform: skew(0deg) scale(1, 0.9);}
    33%  { transform: skew(-6deg) rotate(6deg) scale(1, 0.9); }
    50%  { transform: scale(1, 1.4);}
    66%  { transform: skew(5deg) rotate(-5deg) scale(1, 1.2); }
    90%  { transform: skew(0deg) scale(1, 0.9);}
    100% { transform: skew(0deg) scale(1, 1);}
  }
</style>

<script type="module">
  // -- constants --
  const k = {
    cursor: {
      up: "grab",
      dn: "grabbing"
    }
  }

  // -- props --
  let $el = null
  let $music = null
  let $arch = null
  let $sprites = []
  let $frames = null

  // -- init --
  function Main() {
    // get elements
    $el = document.getElementById("scroll-container")
    $music = document.getElementById("wedding-music")
    $arch = document.getElementById("wedding-arch")
    $sprites = document.getElementsByClassName("WeddingSprite")
    $frames = document.getElementById("frames")

    // setup & bind events
    InitTouch()
    InitCharacters()
    $arch.addEventListener("click", OnArchClicked)
  }

  function InitCharacters() {
    const kDefaultPos = 1500;
    const kRandomOffset = 150;
    const kAnimationDelay = 1;

    const $characters = document.querySelectorAll(".Wedding-guest")
    for (const $character of $characters) {
      if ($character.style.bottom ===  `${kDefaultPos}px`) {
        $character.style.bottom = `${kDefaultPos + kRandomOffset * Math.random()}px`
      }

      $character.style.animationDelay = `${Math.random() * kAnimationDelay}s`
    }
  }

  // -- events --
  function OnArchClicked() {
    const id = d.State.balloonsFilled

    const scale = 1 + Math.random()
    $frames.spawn({
      id: "balloon-" + id,
      src: "assets/42069wedding/balloon/balloon.html",
      many: true,
      partial: true,
      attrs: {
        "w": 5 * scale,
        "h": 10 * scale,
        "temperament": "choleric",
        "extends-to-edges": true
      }
    })
  }

  // -- touch --
  let isTouching = false
  let xi = null
  let yi = null

  function InitTouch() {
    $el.addEventListener("pointerdown", didStartTouch)
    $el.addEventListener("pointermove", didMoveTouch)
    $el.addEventListener("pointerup", didEndTouch)

    const $html = document.querySelector("html")
    $html.addEventListener("pointerout", (evt) => {
      if (evt.target == $html) {
        didEndTouch()
      }
    })
  }

  function didStartTouch(evt) {
    isTouching = true
    xi = evt.clientX
    yi = evt.clientY

    // update style
    $el.style.cursor = k.cursor.dn

    // start elements
    $music.play()
    for (const $sprite of $sprites) {
      $sprite.style.animationPlayState = "running"
    }
  }

  function didMoveTouch(evt) {
    if (!isTouching) {
      return
    }

    const x = evt.clientX
    const y = evt.clientY

    const dx = x - xi
    const dy = y - yi

    $el.scrollBy({
      left: -dx,
      top: -dy
    })

    xi = x
    yi = y
  }

  function didEndTouch() {
    isTouching = false

    // update style
    $el.style.cursor = k.cursor.up

    // pause elements
    $music.pause()
    for (const $sprite of $sprites) {
      $sprite.style.animationPlayState = ""
    }
  }

  // -- bootstrap --
  Main()
</script>