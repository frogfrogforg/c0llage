<style>
    .Cow {
        position: absolute;
        top: 63%;
        height: 30%;
        z-index: 1;
    }
</style>

<body>
    <img class="background" src="./images/25.png">

    <!-- cows -->
    <img id="cow-left" class="Cow cursor-cow" style="left: 5%; width: 30%;" src="./images/Cows.png">

    <img id="cow-right" class="Cow cursor-cow" style="left: 54%; width: 43%" src="./images/Cow1.png">

    <a href="./13microwave.html" class="hotspot cursor-move" style="top: 60%; left: 2%; height: 18%; width: 22%;"></a>

    <!-- secret cow -->
    <div style="visibility:hidden; top: 17%; left: 20%; position:absolute" id="cow-sky">
        <i><span style="font-size:2em;">cow in the sky</span></i>
    </div>
</body>

<script type="module">
    // -- props --
    let $cowLeft = null
    let $cowRight = null
    let $cowSky = null
    let isKissing = false

    // -- commands --
    // see if it's time to kiss
    function checkForKiss() {
        if (isKissing) {
            return true
        }

        const frameL = $cowLeft.getBoundingClientRect()
        const frameR = $cowRight.getBoundingClientRect()

        if (frameL.right - frameR.left > 100) {
            kiss()
        }

        return isKissing
    }

    // make the cows kiss
    function kiss() {
        isKissing = true
        $cowLeft.classList.add("cursor-kiss")
        $cowRight.classList.add("cursor-kiss")
        $cowSky.style.visibility = "visible"
    }

    // move in for the kiss
    function moveInForKiss($cow, velocity) {
        // did they kiss?
        if (checkForKiss()) {
            return
        }

        // if not, move the cow. get current pos
        const left = $cow.style.left
        const pct = Number.parseInt(left.split("%")[0])

        // update with velocity
        $cow.style.left = `${pct + velocity}%`
    }

    // -- main --
    function main() {
        // get cows
        $cowLeft = document.getElementById("cow-left")
        $cowRight = document.getElementById("cow-right")
        $cowSky = document.getElementById("cow-sky")

        let $cowRightScript = document.getElementById("cow-right-script");

        // move cows on click
        $cowLeft.addEventListener("click", (evt) => {
            moveInForKiss($cowLeft, 1.0)
        })

        $cowRight.addEventListener("click", (evt) => {
            moveInForKiss($cowRight, -1.0)
        })

        $cowRight.addEventListener("dragover", (evt) => evt.preventDefault()); // i think this is necessary for drag-drop to work
        $cowRight.addEventListener("drop", (evt) => {
            evt.preventDefault();
            if (evt.dataTransfer.getData("text") == "invitation") {
                if (!d.State.invitedCow1) {
                    $cowRightScript.showNamedDialog('invited');
                    d.State.invitedCow1 = true;
                }
            }
        });
    }

    main()
</script>

<s-cript target="assistant">
    --- click
        Oh, to be young and filled with milk.
    ==> click

</s-cript>

<s-cript target="cow-right" id="cow-right-script">
    --- invited
        Moo
    ==> invited

</s-cript>